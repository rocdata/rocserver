"""
Django settings for standards-server project.

Generated by 'django-admin startproject' using Django 3.1.1.

For more information on this file, see
https://docs.djangoproject.com/en/3.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.1/ref/settings/
"""
import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/3.1/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = "(8%+96rlt0k(=&=6^k*w@h(*u$tjcox20gt@yu#mn1)2ojw)$y"

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ["localhost", "127.0.0.1", "[::1]", "0.0.0.0", "rocdata.global"]

SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')

# Application definition

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.admindocs",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "mptt",
    "rest_framework",
    "rest_framework.authtoken",
    "django_extensions",
    "standards",
    "importers",
    "website",
    "admin_reorder",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
    "admin_reorder.middleware.ModelAdminReorder",
]

ROOT_URLCONF = "standards-server.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "standards-server.wsgi.application"


# Database
# https://docs.djangoproject.com/en/3.1/ref/settings/#databases

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": os.path.join(BASE_DIR, "db.sqlite3"),
    }
}


# Password validation
# https://docs.djangoproject.com/en/3.1/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]


# Internationalization
# https://docs.djangoproject.com/en/3.1/topics/i18n/

LANGUAGE_CODE = "en-us"

TIME_ZONE = "UTC"

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.1/howto/static-files/

STATIC_URL = "/static/"

REST_FRAMEWORK = {
    "DEFAULT_RENDERER_CLASSES": (
        "rest_framework.renderers.TemplateHTMLRenderer",
        "rest_framework.renderers.JSONRenderer",
        "rest_framework.renderers.BrowsableAPIRenderer",
    )
}


APPEND_SLASH = False


if DEBUG:
    INTERNAL_IPS = ["127.0.0.1"]
    # Setup django-silk profiling and DEBUG utils
    INSTALLED_APPS += [
        "silk",
    ]
    MIDDLEWARE = MIDDLEWARE + ["silk.middleware.SilkyMiddleware"]
    SILKY_PYTHON_PROFILER = True
    SILKY_PYTHON_PROFILER_BINARY = True
    SILKY_PYTHON_PROFILER_RESULT_PATH = os.path.join(BASE_DIR, 'profiles')
    if not os.path.exists(SILKY_PYTHON_PROFILER_RESULT_PATH):
        os.makedirs(SILKY_PYTHON_PROFILER_RESULT_PATH)



ADMIN_REORDER = (

    {'app': 'auth', 'models': (
        'auth.User',
        'standards.UserProfile',
        'auth.Group',
        'authtoken.TokenProxy',
    )},

    {'app': 'standards', 'label':'Jurisdictions', 'models': (
        'standards.Jurisdiction',
        'standards.ControlledVocabulary',
        'standards.Term',
        'standards.TermRelation',
    )},

    {'app': 'standards', 'label':'Standards', 'models': (
        'standards.StandardsDocument',
        'standards.StandardNode',
        'standards.StandardsCrosswalk',
        'standards.StandardNodeRelation',
    )},

    {'app': 'standards', 'label':'Content', 'models': (
        'standards.ContentCollection',
        'standards.ContentNode',
        'standards.ContentNodeRelation',
        'standards.ContentCorrelation',
        'standards.ContentStandardRelation',
    )},

)


# ROCDATA-specific settings

ROCDATA_PUBLISHING_CONTEXT = os.getenv("ROCDATA_PUBLISHING_CONTEXT") or "default"

ROCDATA_PUBLISHING_CONTEXTS = {
    'default': {
        "scheme": None,     # set dynamically from per-request
        "netloc": None,     # set dynamically from per-request
        "path_prefix": "",
    },
    'rocserver': {
        "scheme": "https",
        "netloc": "https://rocdata.global",
        "path_prefix": "",
    },
    'w3id.org': {
        "scheme": "https",
        "netloc": "w3id.org",
        "path_prefix": "/rocdata",
    },
    'githubpages_rocserver': {
        "scheme": "https",
        "netloc": "rocdata.github.io",
        "path_prefix": "/rocserver/rocdata",
    },
    'githubpages_standards-ghana': {
        "scheme": "https",
        "netloc": "rocdata.github.io",
        "path_prefix": "/standards-ghana/rocdata",
    },
}



# Static pages (served as google docs HTML embeds)
# Each page is represented as a dictionary with value:
#  - `title` and `meta_description` are the page metadata (important for SEO)
#  - `gdoc_url` is the source google doc (editable)
#  - `embed_url` is the URL resulting from "Publish to the web" step of the gdoc

WEBSITE_PAGES_GOOGLE_DOCS = {
    "homepage": {
        "title": "Repository of Organized Curriculums (ROC)",
        "meta_description": "The Repository of Organized Curriculums (ROC) is "
            "a database that supports the mapping of digital learning resources "
            "to national curriculum standards.",
        "gdoc_url": "https://docs.google.com/document/d/1affxpkmUNIsbEV-vFGVdrS1-QX-c6psV5tMWMi29OcA/edit",
        "embed_url": "https://docs.google.com/document/d/e/2PACX-1vSpoVgrGxjdX6zvflSKzSwnxEvWb7yiVAyj9wz421Q-TBMP5hUksO12aE9StNKd5udafC1ylCmwdooZ/pub?embedded=true",
    },
    "background": {
        "title": "Understanding how to #design2align curricula to national standards",
        "meta_description": "Learn about the multi-stakeholder collaboration to create "
            "a set of tools that can automate the mapping of digital learning "
            "resources to national curriculum standards.",
        "gdoc_url": "https://docs.google.com/document/d/1YkWBaEFzzaZMnrR3JITg2JmA45BElV1M8XGXwZ7jgIk/edit",
        "embed_url": "https://docs.google.com/document/d/e/2PACX-1vTWmDDroUbrqanSsPZfbcWChzNabMtWYkHTUSKQW_oAi_x-v_BSyyZNoWMj8hNhJY9bKUCfws41m2jC/pub?embedded=true",
    },
    "glossary": {
        "title": "Glossary of terms",
        "meta_description": "A reference glossary and list of terminology from the Repository of Organized Curriculums report and website.",
        "gdoc_url": "https://docs.google.com/document/d/1IFkY9Znm9pnhZIjdQOtR7PtO1WE8MXhDEsHgUTRrwNQ/edit",
        "embed_url": "https://docs.google.com/document/d/e/2PACX-1vTtvILmMC7A_eax42xDOI8dXAcf0-W86rbc3z4nrHPXbLo3URyZEHGnWlmXzixgIOKTxS6WVDqC_VD_/pub?embedded=true",
    },
    "contribute": {
        "title": "Get involved",
        "meta_description": "Learn how you can get involved and contribute curriculum standards data to the Repository of Organized Curriculums (ROC) data project.",
        "gdoc_url": "https://docs.google.com/document/d/1hGk62PlLga55vh-RrPb4-Pt5OsiobO9IHDuR5Mzfvl8/edit",
        "embed_url": "https://docs.google.com/document/d/e/2PACX-1vT40TlZmF91lx6ZSZFMxyeBdGmSzIQGMvvgLtlKDAweJcpF8L8WWGh6KQBLtBIIm33dygIsYsjDJI-o/pub?embedded=true",
    },
}
